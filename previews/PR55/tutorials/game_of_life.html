<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic Game of Life ¬∑ StochasticAD.jl</title><meta name="title" content="Stochastic Game of Life ¬∑ StochasticAD.jl"/><meta property="og:title" content="Stochastic Game of Life ¬∑ StochasticAD.jl"/><meta property="twitter:title" content="Stochastic Game of Life ¬∑ StochasticAD.jl"/><meta name="description" content="Documentation for StochasticAD.jl."/><meta property="og:description" content="Documentation for StochasticAD.jl."/><meta property="twitter:description" content="Documentation for StochasticAD.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="../assets/extra_styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">StochasticAD.jl</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Overview</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="random_walk.html">Random walk</a></li><li class="is-active"><a class="tocitem" href="game_of_life.html">Stochastic Game of Life</a><ul class="internal"><li><a class="tocitem" href="#Setting-up-the-stochastic-Game-of-Life"><span>Setting up the stochastic Game of Life</span></a></li><li><a class="tocitem" href="#Differentiating-the-Game-of-Life"><span>Differentiating the Game of Life</span></a></li></ul></li><li><a class="tocitem" href="particle_filter.html">Differentiable particle filter</a></li><li><a class="tocitem" href="optimizations.html">Stochastic optimizations with discrete randomness</a></li></ul></li><li><a class="tocitem" href="../public_api.html">Public API</a></li><li><a class="tocitem" href="../limitations.html">Limitations</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="game_of_life.html">Stochastic Game of Life</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="game_of_life.html">Stochastic Game of Life</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/gaurav-arya/StochasticAD.jl" title="View the repository on GitHub"><span class="docs-icon fab">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/gaurav-arya/StochasticAD.jl/blob/main/docs/src/tutorials/game_of_life.md" title="Edit source on GitHub"><span class="docs-icon fas">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button docs-navbar-link fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Stochastic-Game-of-Life"><a class="docs-heading-anchor" href="#Stochastic-Game-of-Life">Stochastic Game of Life</a><a id="Stochastic-Game-of-Life-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-Game-of-Life" title="Permalink"></a></h1><p>We consider a stochastic version of <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway&#39;s Game of Life</a>, played on a two-dimensional board. We shall use the following packages,</p><pre><code class="language-julia hljs">using Distributions
using StochasticAD
using OffsetArrays
using StaticArrays</code></pre><h2 id="Setting-up-the-stochastic-Game-of-Life"><a class="docs-heading-anchor" href="#Setting-up-the-stochastic-Game-of-Life">Setting up the stochastic Game of Life</a><a id="Setting-up-the-stochastic-Game-of-Life-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-the-stochastic-Game-of-Life" title="Permalink"></a></h2><p>Each turn, the standard Game of Life applies the following rules to each cell,</p><p class="math-container">\[\text{dead and 3 neighbours alive} \to \text{ alive}, \\
\text{alive and 0, 1, or 4 neighbours alive} \to \text{ dead}.\]</p><p>The cell&#39;s status does not change otherwise. In our stochastic version, these rules instead occur with probability <code>1-Œ∏</code>, while the opposite event has probability <code>Œ∏</code>. To initialize the board at the beginning of the game, we randomly set each cell alive with probability <code>p</code>. </p><p>The following high level function sets up the probabilities and provides them to <code>play_game_of_life</code>.</p><pre><code class="language-julia hljs">function play(p, Œ∏=0.1, N=12, T=10; log=false)
    # N is the board half-length, T are game time steps
    low = Œ∏
    high = 1-Œ∏
    birth_probs = SA[low, low, low, high, low] # 0, 1, 2, 3, 4 neighbours
    death_probs = SA[high, high, low, low, high] # 0, 1, 2, 3, 4 neighbours
    return play_game_of_life(p, vcat(birth_probs, death_probs), N, T; log)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">play (generic function with 4 methods)</code></pre><p>We can now implement the Game of Life based on the specification. At the end of the game, we return the total number of alive cells.</p><pre><code class="language-julia hljs"># A single turn of the game
function update_state(all_probs, N, board_new, board_old)
    for i in -N:N
        for j in -N:N
            neighbours = board_old[i+1, j] + board_old[i-1, j] + board_old[i, j-1] + board_old[i, j+1]
            index = board_new[i,j] * 5 + neighbours + 1
            b = rand(Bernoulli(all_probs[index]))
            board_new[i,j] += (1 - 2 * board_new[i,j]) * b
        end
    end
end

function play_game_of_life(p, all_probs, N, T; log=false)
    dual_type = promote_type(typeof(rand(Bernoulli(p))), typeof.(rand.(Bernoulli.(all_probs)))...) # a hacky way of getting the correct array type
    board = OffsetArray(zeros(dual_type, 2*N + 3, 2*N + 3), -(N+1):(N+1), -(N+1):(N+1)) # center board at (0,0), pad by 1

    # initialize the board
    for i in -N:N
        for j in -N:N
            board[i,j] = rand(Bernoulli(p))
        end
    end
    board_old = similar(board)
    log &amp;&amp; (history = [])

    # play the game
    for time_step in 1:T
        copy!(board_old, board)
        update_state(all_probs, N, board, board_old)
        log &amp;&amp; push!(history, copy(board))
    end

    if !log
        return sum(board)
    else
        return sum(board), board, history
    end
end

play(0.5, 0.1) # play the game with p = 0.5 and Œ∏ = 0.1</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">83</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Note that we did have to be careful to write this program to be compatible with the <a href="../limitations.html">current capabilities of <code>StochasticAD</code></a>. For example, we concatenated <code>birth_probs</code> and <code>death_probs</code> into a single array <code>all_probs</code> and used the index <code>board[i, j] * 5 + neighbours + 1</code> to find the probability, rather than use the more natural <code>if alive... else...</code> syntax.</p></div></div><h2 id="Differentiating-the-Game-of-Life"><a class="docs-heading-anchor" href="#Differentiating-the-Game-of-Life">Differentiating the Game of Life</a><a id="Differentiating-the-Game-of-Life-1"></a><a class="docs-heading-anchor-permalink" href="#Differentiating-the-Game-of-Life" title="Permalink"></a></h2><p>Let&#39;s differentiate the Game of Life!</p><pre><code class="language-julia hljs">@show stochastic_triple(play, 0.5) # let&#39;s take a look at a single stochastic triple

samples = [derivative_estimate(play, 0.5) for i in 1:10000] # take many samples
derivative = mean(samples)
uncertainty = std(samples) / sqrt(10000)
println(&quot;derivative of ùîº[play(p)] = $derivative ¬± $uncertainty&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">stochastic_triple(play, 0.5) = 96 + 0Œµ + (-1 with probability 438.0Œµ, tag 1)
derivative of ùîº[play(p)] = 143.2476 ¬± 14.683700054623609</code></pre><p>The following sketch of the final state of the board for a single run gives some insight into what the stochastic triples are doing. The original board is depicted in grey and white for dead and alive, and the cells which flip from dead to alive in the &quot;alternative&quot; path consider by the triples are marked with + signs, while the cells which flip from alive to dead are marked with X signs.</p><img src="../images/final_gol_board.png" width="50%"/><p>‚†Ä</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="random_walk.html">¬´ Random walk</a><a class="docs-footer-nextpage" href="particle_filter.html">Differentiable particle filter ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.28.0-DEV on <span class="colophon-date" title="Tuesday 24 January 2023 19:49">Tuesday 24 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
